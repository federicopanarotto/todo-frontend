<div class="d-flex justify-content-center">
  <div class="p-3 col-md-8 col-lg-6 shadow-lg m-4 rounded">
    <h1 class="text-center mb-3">To do list</h1>
    <div class="mb-3 d-flex align-items-center justify-content-between gap-2">
      <!-- Checkbox showCompleted -->
      <div class="border rounded p-2">
        <app-checkbox
          [text]="'Mostra completati'"
          [value]="(checkSubject | async)!"
          (checkboxChange)="setCheckValue($event)"
        ></app-checkbox>
      </div>
      <!-- Button create todo -->
      <div>
        <button 
          class="btn btn-primary p-2"
          (click)="openModal(content)"
        ><i class="bi bi-plus-lg"></i> Nuovo to do</button>
      </div>
    </div>

    <!-- Todo list -->
    <div *ngIf="todos$ | async as todos">
      <div *ngFor="let todo of todos" class="mb-3">
        <app-todo-card
          [todo]="todo"
          [completed]="todo.completed"
          (completeChange)="todoCheckComplete(todo, $event)"
        ></app-todo-card>
      </div>
    </div>

  </div>
</div>
<footer class="p-3">
  <p class="text-center">Created by Federico Panarotto</p>
</footer>

<ng-template #content let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Nuovo to do</h4>
		<button type="button" class="btn-close" (click)="dismissModal(modal)"></button>
	</div>
	<div class="modal-body">

		<form [formGroup]="todoForm">
      <div class="mb-3">
				<label for="dateOfBirth">Titolo</label>
				<div class="input-group">
					<input
						id="title"
						class="form-control"
						placeholder="es. compito x"
						name="title"
            type="text"
            formControlName="title"
            [class.is-invalid]="(todoForm.get('title')?.dirty || todoForm.get('title')?.touched) && todoForm.get('title')?.invalid"
					/>
				</div>
        <div *ngIf="todoForm.get('title')?.invalid && (todoForm.get('title')?.dirty || todoForm.get('title')?.touched)" class="text-danger">
          Il titolo Ã¨ obbligatorio.
        </div>
			</div>
      <div class="mb-3">
				<label for="dateOfBirth">Scadenza (opzionale)</label>
				<div class="input-group">
					<input
						id="dueDate"
						class="form-control"
						placeholder="yyyy-mm-dd"
						name="dp"
						ngbDatepicker
						#dp="ngbDatepicker"
            formControlName="dueDate"
            [class.is-invalid]="todoForm.get('dueDate')?.invalid"
					/>
					<button class="btn btn-outline-secondary bi bi-calendar3" (click)="dp.toggle()" type="button"></button>
				</div>
        <div *ngIf="todoForm.get('dueDate')?.invalid" class="text-danger">
          Formato data non corretto
        </div>
			</div>
		</form>
    
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-outline-secondary" (click)="closeModal(modal)">Crea</button>
	</div>
</ng-template>